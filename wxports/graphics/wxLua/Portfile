# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0
PortGroup           cmake 1.0
PortGroup           wxWidgets 1.0

name                wxLua
set svnrev          190
# TODO: maybe the version string should also include the SVN revision
version             2.8.12.3
categories          graphics devel
platforms           darwin freebsd
maintainers         afb
description         Lua bindings for wxWidgets
long_description    wxLua is a lua scripting language wrapper around the \
                    wxWidgets cross-platform GUI library. It consists of an \
                    executable for running standalone wxLua scripts and a \
                    library for extending C++ programs with a fast, small, \
                    fully embeddable scripting language.

# fetching sources from SVN because no sources seem to have been released recently,
# but they are needed in order to work with wxWidgets 2.9.
# There were only windows binaries. As soon as some recent version gets released,
# fetching from SVN should stop.
homepage            http://wxlua.sourceforge.net/
#master_sites       sourceforge:wxlua
# TODO: not sure if this will always work
master_sites        http://sourceforge.net/code-snapshots/svn/w/wx/wxlua/svn/

#distname           ${name}-${version}-src
distname            wxlua-svn-${svnrev}-trunk

use_zip             yes

checksums           rmd160  e80e124424a4d610a256e619ca4b5435f66f823a \
                    sha256  9fcf55b5caee3d157669c101d8112a0c3cd7ac5ed7c9de1be9dff0f0380a919e

wxWidgets.use       wxWidgets-3.0

depends_lib         port:lua \
                    port:readline \
                    port:${wxWidgets.port}

# port:wxstedit seems to be built in now; check what is still needed, if anything

worksrcdir          ${distname}/wxLua

# TODO: not sure how to translate these options
#
# configure.args      --mandir=${prefix}/share/man \
#                     --with-wx-prefix=${prefix} \
#                     --enable-wxbindstc --enable-luamodule \
#                     --with-lua-prefix=${prefix} \
#                     --enable-wxluafreeze-app

configure.args-append \
                    -DwxWidgets_CONFIG_EXECUTABLE=${wxWidgets.wxconfig} \
                    -DBUILD_INSTALL_PREFIX=${prefix} \
                    -DwxLua_LUA_LIBRARY_BUILD_SHARED=OFF \
                    -DwxLua_LUA_LIBRARY_USE_BUILTIN=ON \
                    -DwxLua_LUA_LIBRARY_VERSION=5.2

# TODO: there is no FindLua52.cmake, but FindLua51 finds the right includes & libraries,
#       except that it then fails to compile; when using the builtin lua,
#       we need to delete lua afterwards

#                   -DwxLua_LUA_INCLUDE_DIR=${prefix}/include \
#                   -DwxLua_LUA_LIBRARY=${prefix}/lib/liblua.dylib \
#                   -DLUA_INCLUDE_DIR=${prefix}/include \
#                   -DLUA_LIBRARIES=${prefix}/lib/liblua.dylib \
#                   -DLUA_LIBRARY=${prefix}/lib/liblua.dylib

# TODO:
# - report upstream that they need to replace DBUILD_INSTALL_PREFIX with CMAKE_INSTALL_PREFIX

post-destroot {
    xinstall -d -m 0755 ${destroot}${applications_dir}
    # TODO: wxLuaFreeze isn't really working as an app
    foreach {app} {wxLua wxLuaCan wxLuaEdit wxLuaFreeze} {
        move "${destroot}${prefix}/bin/${app}.app" ${destroot}${applications_dir}
    }
    delete ${destroot}${prefix}/share/wxstedit
    delete ${destroot}${prefix}/doc/wxStEdit
    # TODO: probably also needed
    # delete ${destroot}${prefix}/include/wx/stedit
    # delete ${destroot}${prefix}/lib/libwxstedit-wx29osx_cocoau-1.6.0.dylib
    # TODO: check that there is no bin/lua & bin/luac
    delete ${destroot}${prefix}/bin/lua
    delete ${destroot}${prefix}/bin/luac
}

# TODO: check which of these are still needed
#
# post-destroot {
#     # these includes conflict with the "lua" port:
#     delete "${destroot}${prefix}/include/lauxlib.h"
#     delete "${destroot}${prefix}/include/lua.h"
#     delete "${destroot}${prefix}/include/luaconf.h"
#     delete "${destroot}${prefix}/include/lualib.h"
#
#     # provide a symbolic link to the wxLua sample programs
#     ln -sf "${prefix}/share/wxlua/samples" "${destroot}${appPath}/Samples"
# 
#     # set up a wrapper so that you can call "wxlua *.wx.lua"
#     xinstall -m 0755 "${filespath}/wxlua.sh" "${destroot}${prefix}/bin/wxlua"
#     # set up a wrapper so that you can call "wxluaedit" too
#     xinstall -m 0755 "${filespath}/wxluaedit.sh" "${destroot}${prefix}/bin/wxluaedit"
# }

livecheck.type      sourceforge
livecheck.name      wxlua
