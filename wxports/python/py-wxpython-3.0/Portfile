# -*- coding: utf-8; mode: tcl; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=2:ts=2:sts=2
# $Id: $

PortSystem          1.0
PortGroup           python 1.0

name                py-wxpython-3.0
version             2.9.4.0
categories          graphics devel
license             wxwidgets-3.1
platforms           darwin
maintainers         jwa mojca

description         Python interface to the wxWindows cross platform GUI
long_description    wxPython is a GUI toolkit for the Python programming \
                    language. It allows Python programmers to create \
                    programs with a robust, highly functional graphical \
                    user interface, simply and easily. It is implemented \
                    as a Python extension module (native code) that wraps \
                    the popular wxWindows cross platform GUI library, \
                    which is written in C++.

homepage            http://www.wxpython.org/
master_sites        sourceforge:wxpython

distname            wxPython
use_bzip2           yes

checksums           rmd160  35e823d9161dc99083f3025383567000680e012f \
                    sha256  78c35c19e85a17cb9c730b86b49d6a479198d76d19e0b13e86db0b55707004be

# TODO: there is no need to provide all of these; at the moment this is just for testing
python.versions     24 25 26 27
#python.default_version  27

# TODO: number 2.9 should be automatic based on version
#       copy these variables from wxPython port or wxWidgets PortGroup
set installdir      ${frameworks_dir}/wxWidgets.framework/Versions/wxPython/2.9
set confscript      ${installdir}/bin/wx-config

if {${os.major} < 9} {
   pre-fetch {
       ui_error "${name} requires Mac OS X 10.5 or later."
       return -code error "incompatible Mac OS X version"
   }
}

distfiles           ${distname}-src-${version}${extract.suffix}
dist_subdir         ${distname}/${version}
worksrcdir          ${distname}-src-${version}/wxPython

# extract just the docs and wxPython subdir
extract.post_args   "| tar -xf - ${worksrcdir} ${distname}-src-${version}/docs"

# TODO: please check why
# universal_variant no

# from the old port, doesn't work for me
# build.env       UNICODE="1" WXPORT="osx_cocoa" PATH="${installdir}/lib/wx/config:$env(PATH)"
# destroot.env    UNICODE="1" WXPORT="osx_cocoa" PATH="${installdir}/lib/wx/config:$env(PATH)"


if {$subport != $name} {
    depends_lib-append  port:wxPython-3.0

    patchfiles      patch-config.py.diff

    # TODO: is it possible to use build arguments instead of redefining the whole command?
    build.cmd       ${python.bin} setup.py WX_CONFIG="${confscript}"
    destroot.cmd    ${python.bin} setup.py WX_CONFIG="${confscript}"

    livecheck.type  none
} else {
    post-destroot {
        xinstall -d -m 755 ${destroot}${prefix}/share/doc/
        file copy ${worksrcpath}/docs ${destroot}${prefix}/share/doc/${name}
        file copy ${worksrcpath}/samples ${destroot}${prefix}/share/doc/${name}/examples
    }

    livecheck.type  regex
    livecheck.url   ${homepage}
    livecheck.regex wxPython(?: | \\(classic\\) )(2\\.\[0-9\]+\\.\[0-9\]+\\.\[0-9\]+)
}
