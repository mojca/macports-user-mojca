# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0
PortGroup           crossbinutils 1.0

# TODO: maybe make a portgroup
set mingw_name      w64-mingw32
set mingw_target    x86_64-${mingw_name}
set mingw_prefix    ${prefix}/${mingw_target}

crossbinutils.setup ${mingw_target} 2.24

maintainers         mojca openmaintainer
homepage            http://mingw-w64.sourceforge.net/

checksums           rmd160  b4aa3ea5ba9d0d9f817b2cf136e7f911f692af8d \
                    sha256  e5e8c5be9664e7f7f96e0d09919110ab5ad597794f5b1809871177a0f0f14137

# TODO: try to use ${prefix} for --prefix and --with-sysroot,
#       but figure out how to do that consistently
configure.pre_args-delete \
                    --prefix=${prefix}
configure.args-append \
                    --prefix=${mingw_prefix} \
                    --with-sysroot=${mingw_prefix} \
                    --disable-multilib \
                    --disable-werror

# TODO: this code should be removed once --prefix gets fixed
post-destroot {
    ui_info "path: ${destroot}${mingw_prefix}/bin"
    foreach file [glob -tails -directory ${destroot}${mingw_prefix}/bin ${mingw_target}-*] {
        ln -s "${mingw_prefix}/bin/${file}" "${destroot}${prefix}/bin/"
    }
}
