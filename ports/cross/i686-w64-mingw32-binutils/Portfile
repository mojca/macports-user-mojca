# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0
PortGroup           crossbinutils 1.0

# TODO: maybe make a portgroup
set mingw_name      w64-mingw32
set mingw_target    i686-${mingw_name}
set mingw_prefix    ${prefix}/${mingw_target}

crossbinutils.setup ${mingw_target} 2.26.1

maintainers         mojca openmaintainer
homepage            http://mingw-w64.sourceforge.net/

checksums           rmd160  a4933fbd12056edc1933d3a5379cd7a2cffef185 \
                    sha256  39c346c87aa4fb14b2f786560aec1d29411b6ec34dce3fe7309fe3dd56949fd8

# TODO: try to use ${prefix} for --prefix and --with-sysroot,
#       but figure out how to do that consistently
configure.pre_args-delete \
                    --prefix=${prefix}
configure.args-append \
                    --prefix=${mingw_prefix} \
                    --with-sysroot=${mingw_prefix} \
                    --disable-multilib \
                    --disable-werror

# TODO: this code should be removed once --prefix gets fixed
post-destroot {
    ui_info "path: ${destroot}${mingw_prefix}/bin"
    foreach file [glob -tails -directory ${destroot}${mingw_prefix}/bin ${mingw_target}-*] {
        ln -s "${mingw_prefix}/bin/${file}" "${destroot}${prefix}/bin/"
    }
}
