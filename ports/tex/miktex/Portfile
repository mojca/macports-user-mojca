# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0
PortGroup           cmake 1.0
PortGroup           compiler_blacklist_versions 1.0

name                miktex
version             2.9-2016-05-18
categories          tex
platforms           darwin
license             unknown
maintainers         mojca openmaintainer

description         miktex-tools â€” experimental TeX additions
long_description    ${description}

homepage            http://miktex.org/

master_sites        http://mirrors.ctan.org/systems/win32/miktex/source/
use_xz              yes

checksums           rmd160  e14030b6d16c8032a80ecc86c12eb7eaf6573c7f \
                    sha256  9b91e8c2abf6a1e8288d9ec71572855c6aaf1970eca1fafb9416368a1c943c12

cmake.out_of_source yes

compiler.blacklist-append *gcc* {clang < 500} macports-clang-3.3 macports-clang-3.4
compiler.fallback-append  macports-clang-3.7 macports-clang-3.6 macports-clang-3.5

# some version of python is needed as well (fix!)
depends_build-append \
                    port:bison \
                    port:dos2unix \
                    port:flex \
                    port:ImageMagick \
                    port:pandoc \
                    port:pkgconfig \
                    port:python27 \
                    port:xsltproc
depends_lib-append  port:apr \
                    port:apr-util \
                    port:botan \
                    port:bzip2 \
                    port:cairo \
                    port:curl \
                    port:expat \
                    port:fontconfig \
                    port:freetype \
                    port:gd2 \
                    port:gmp \
                    port:graphite2 \
                    port:harfbuzz-icu \
                    port:hunspell \
                    port:icu \
                    port:jpeg \
                    port:log4cxx \
                    port:libzzip \
                    port:libpng \
                    port:libpixman \
                    port:log4cxx \
                    port:mpfr \
                    port:poppler \
                    port:popt \
                    port:potrace \
                    port:qt5-qtscript \
                    port:uriparser \
                    port:xz \
                    port:zlib

# port:mspack

patchfiles          patch-CMakeLists.txt.diff \
                    patch-BuildUtilities-c4p-gram.y.diff \
                    patch-Libraries-MiKTeX-Core-Utils-AutoTraceTime.h.diff \
                    patch-Libraries-MiKTeX-Core-Session-SessionImpl.h.diff

configure.args-append \
                    -DWITH_UI_QT=OFF \
                    -DHUNSPELL_LIBRARY=${prefix}/lib/libhunspell-1.3.0.dylib \
                    -DUSE_SYSTEM_MSPACK=OFF

# C++ libraries:
# -DUSE_SYSTEM_BOTAN=OFF \
# -DUSE_SYSTEM_POPPLER=OFF \
# -DUSE_SYSTEM_LOG4CXX=OFF \
# -DUSE_SYSTEM_HARFBUZZ_ICU=OFF \
# -DUSE_SYSTEM_HUNSPELL=OFF

platform darwin {
    if { ${configure.cxx_stdlib} ne "libc++" } {
        configure.cxx_stdlib libc++
        depends_lib-append port:libcxx
    }
}
