# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0
PortGroup           cmake 1.0
PortGroup           github 1.0

# TODO: just temporary
github.setup        mojca opengate f14c352c92

name                gate
version             6.2
categories          science
maintainers         mojca
license             LGPL
description         GATE description
long_description    GATE is dedicated to numerical simulations in medical imaging and radiotherapy. \
                    It currently supports simulations of Emission Tomography (PET and SPECT), \
                    Computed Tomography (CT) and Radiotherapy experiments.
homepage            http://www.opengatecollaboration.org
platforms           darwin

# distfiles           gate_v6_2_tar_gz_15843.gz
# master_sites        http://www.opengatecollaboration.org/sites/opengatecollaboration.org/files/gate_release/2012/08/

checksums           rmd160  b21ab59aa0d7dec9771a9e5a213ee8d739c5666e \
                    sha256  843424c70c27e4f26cf64b99ddc73b614a0be2abed25a7a48af739eaa5f881f3

worksrcdir          gate_v${version}
configure.dir       ${workpath}/build
build.dir           ${configure.dir}

post-extract {
    file mkdir ${configure.dir}
}

configure.post_args ${worksrcpath}

# copy examples
# TODO: this must be done in a better way
post-patch {
    # replace "/vis/open OGLIX" with "/vis/open OGLIQt" (not sure about the difference between OGLIQt and OGLSQt)
    foreach examplefile {gpumacros/ct/mac/visu.mac gpumacros/optical/macro_biolum_cpu.mac gpumacros/optical/macro_biolum_gpu.mac gpumacros/pet/mac/visu.mac gpumacros/photradthera/mac/visu.mac example_CT/classic/visu.mac example_CT/fast/visu.mac example_CT/vrt/visu.mac example_OPTICAL/macro/Visualisation.mac example_PET/PET_CylindricalPET_System.mac example_PET/PET_Ecat_System.mac example_PHANTOM_SOURCE/Voxelized_Phantom_Source/mainMacro.mac example_SPECT/vis.mac example_TimeActivityCurve/vis.mac example_TrackerDetector/visu.mac} {
        reinplace "s|OGLIX|OGLIQt|g" ${worksrcpath}/examples/${examplefile}
        reinplace "s|OGLSX|OGLIQt|g" ${worksrcpath}/examples/${examplefile}
        system "echo ${examplefile}"
    }
}
pre-destroot {
    set destdocdir ${destroot}${prefix}/share/doc/${name}
    xinstall -m 755 -d ${destdocdir}
    file copy ${worksrcpath}/examples ${destdocdir}
    # TODO: remove CMake files and add material database
}

depends_lib         port:geant4.9.6
# clhep implied with geant4

# depends_lib         port:clhep \
#                     port:zlib

# WITH_GEANT4_UIVIS=ON
variant qt description {Build with Qt support} {
    depends_lib-append  port:qt4-mac

    # configure.args-append -DGEANT4_USE_QT=ON
    # maybe we need more variables?
}

configure.args-append -DGATE_USE_SYSTEM_CLHEP=ON
# configure.args-append -DGEANT4_INSTALL_DATA=ON \
#                       -DGEANT4_BUILD_EXAMPLES=ON \
#                       -DGEANT4_INSTALL_EXAMPLES=ON \
#                       -DWITH_GEANT4_UIVIS=ON \
#                       -DGEANT4_USE_OPENGL_X11=ON

# TODO: this should come from Geant4 PortGroup
configure.args-append -DGeant4_DIR=${prefix}/lib/Geant4/Geant4.9.6/Geant4-9.6.2

default_variants +qt
