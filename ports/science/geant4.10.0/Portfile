# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0
PortGroup           cmake 1.0

name                geant4.10.0
# TODO: how to recognize whether a version is newer? Do we need an extra string/number? I'm not sure about b01/p02
version             4.10.00.b01
categories          science
maintainers         nomaintainer
license             Geant4
description         Geant4 is a toolkit for the simulation of the passage of particles through matter.
long_description    Geant4 is a toolkit for the simulation of the passage of particles through matter. \
                    Its areas of application include high energy, nuclear and accelerator physics, as well as studies in medical and space science. \
                    The two main reference papers for Geant4 are published in Nuclear Instruments and Methods in Physics Research A 506 (2003) 250-303, \
                    and IEEE Transactions on Nuclear Science 53 No. 1 (2006) 270-278.
homepage            http://geant4.web.cern.ch/
platforms           darwin

set simpleversion 4.10.0

distfiles           geant${version}.tar.gz

master_sites        http://geant4.cern.ch/support/source/

checksums           rmd160  14820eca2893ffa7a27cd44f51c6c9b4b125b491 \
                    sha256  0fa7c9b0e1b09fd11b682523b839b4c6c67f4c3cd5bc9a9357512c37ea4a9e1e

worksrcdir          geant${version}
configure.dir       ${workpath}/build
build.dir           ${configure.dir}

post-extract {
    file mkdir ${configure.dir}
}

patchfiles          patch-cmake_Modules_FindAIDA.cmake.diff

configure.post_args ${worksrcpath}

depends_lib         port:geant4-data-G4NDL-4.3 \
                    port:geant4-data-G4EMLOW-6.33 \
                    port:geant4-data-PhotonEvaporation-2.3 \
                    port:geant4-data-RadioactiveDecay-3.7 \
                    port:geant4-data-G4NEUTRONXS-1.3 \
                    port:geant4-data-G4PII-1.3 \
                    port:geant4-data-RealSurface-1.0 \
                    port:geant4-data-G4SAIDDATA-1.1 \
                    port:zlib \
                    port:expat \
                    port:root \
                    port:aida
#

variant qt description {Build with Qt support} {
    depends_lib-append  port:qt4-mac

    configure.args-append -DGEANT4_USE_QT=ON
    # maybe we need more variables?
}

# TODO: no need for a separate option
variant clhep description {Use external CLHEP} {
    depends_lib-append port:clhep

    configure.args-append -DGEANT4_USE_SYSTEM_CLHEP=ON \
                          -DCLHEP_CONFIG_EXECUTABLE=${prefix}/bin/clhep-config \
                          -DCLHEP_INCLUDE_DIR=${prefix}/include \
                          -DCLHEP_LIBRARY=${prefix}/lib/libCLHEP.dylib
}

# TODO: figure out how to install binaries somewhere else
variant examples requires clhep description {Build and install examples} {
    configure.args-append -DGEANT4_BUILD_EXAMPLES=ON \
                          -DGEANT4_INSTALL_EXAMPLES=ON
}

configure.args-append -DGEANT4_INSTALL_DATA=OFF \
                      -DGEANT4_INSTALL_DATADIR=${prefix}/share/Geant4/Data \
                      -DCMAKE_INSTALL_BINDIR=libexec/Geant4/Geant${simpleversion} \
                      -DCMAKE_INSTALL_DATAROOTDIR=share/Geant4 \
                      -DCMAKE_INSTALL_INCLUDEDIR=include/Geant4/Geant${simpleversion} \
                      -DCMAKE_INSTALL_LIBDIR=lib/Geant4/Geant${simpleversion} \
                      -DGEANT4_USE_OPENGL_X11=ON

# GEANT4_USE_OPENGL_X11 should be a separate options with all dependencies

# DATAROOTDIR: Geant automatically adds Geant4-10.0.0 (any way to prevent this?)
# INCLUDEDIR: /opt/local/include/Geant4/Geant4.10.0/Geant4 (any way to prevent double Geant4?)
# CMake file are under /opt/local/lib/Geant4/Geant4.10.0/Geant4-10.0.0/*.cmake
# CMAKE_INSTALL_BINDIR: this installs binaries to a non-default location;
#     port select could be used to get the default installation, but all three scripts in bindir need patching to properly detect their location

default_variants +qt +clhep
