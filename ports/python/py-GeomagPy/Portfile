# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0
PortGroup           app 1.0
PortGroup           python 1.0

name                py-geomagpy
python.rootname     GeomagPy
version             0.1.334
platforms           darwin
license             GPL-3
maintainers         mojca openmaintainer

description         Geomagnetic analysis tools.
long_description    ${description}

homepage            http://pypi.python.org/pypi/${python.rootname}/
master_sites        pypi:[string index ${python.rootname} 0]/${python.rootname}
distname            ${python.rootname}-${version}

checksums           rmd160  6882dbe689ca2c39877e8cc284ef44f9ecdc5c08 \
                    sha256  4551cf10d4fae1305ab178de5e1e9a579911832093c1dd866f825bf9fd9f8899

python.versions     27 34

# TODO:
# - spacepy might be missing
# - propenly enable and test MySQL
if {${name} ne ${subport}} {
    # TODO: mysql
    depends_build-append \
                    port:py${python.version}-setuptools
    depends_run-append \
                    port:py${python.version}-numpy \
                    port:py${python.version}-scipy \
                    port:py${python.version}-netcdf4 \
                    port:py${python.version}-pexpect \
                    port:py${python.version}-wxpython-3.0

    patchfiles      patch-gui-xmagpy.py.diff \
                    patch-setup.py.diff

    post-patch {
        reinplace "s|/usr/bin/env python|${python.bin}|" ${worksrcpath}/magpy/gui/xmagpy.py
        delete ${worksrcpath}/bin/example.py
    }

    post-destroot {
        set f ${python.pkgd}/magpy/gui/xmagpy.py
        file attributes ${destroot}${f} -permissions 0755
        ln -s ${f} ${destroot}${prefix}/bin/xmagpy-${python.branch}
    }

    # this could be a +gui option, enabled by default
    app.name            MagPy-${python.version}
    # this doesn't work because post-destroot did not finish yet and xmagpy doesn't exist
    # app.executable    xmagpy-${python.version}
    app.executable      ${python.pkgd}/magpy/gui/xmagpy.py
    app.icon            ${worksrcpath}/magpy/gui/magpy.png

    livecheck.type      none
} else {
    livecheck.type      pypi
}
